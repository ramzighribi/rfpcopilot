(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{2383:()=>{},2770:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>eW});var a=t(5155),r=t(5959),n=t(9863);let l=(0,r.v)()((0,n.Zr)(e=>({currentStep:1,llmConfigs:[],projectData:null,generationParams:{language:"Fran\xe7ais",responseLength:"Moyenne",persona:"Expert Dynamics 365 Sales",instructions:""},results:[],generationProgress:{current:0,total:0},selectedResultIndex:null,columnOrder:[],generationLogs:[],setCurrentStep:s=>e({currentStep:s}),addLlmConfig:()=>e(e=>({llmConfigs:[...e.llmConfigs,{id:Date.now().toString(),provider:"",apiKey:"",azureAuthMode:"apiKey",endpoint:"",apiVersion:"2025-01-01-preview",deployment:"",model:"gemini-1.5-flash",isValidated:!1}]})),updateLlmConfig:(s,t)=>e(e=>({llmConfigs:e.llmConfigs.map((e,a)=>a===s?{...e,...t}:e)})),removeLlmConfig:s=>e(e=>({llmConfigs:e.llmConfigs.filter((e,t)=>t!==s)})),loadLlmConfigs:s=>e({llmConfigs:s}),setProjectData:s=>e({projectData:s}),setMapping:(s,t,a)=>e(e=>{if(!e.projectData)return{};let r="question"===t?"questionColumn":"answerColumn",n=e.projectData.sheets.map(e=>e.name===s?{...e,[r]:a}:e);return{projectData:{...e.projectData,sheets:n}}}),setGenerationParams:s=>e(e=>({generationParams:{...e.generationParams,...s}})),setResults:s=>e({results:s}),setGenerationProgress:s=>e({generationProgress:s}),setSelectedResultIndex:s=>e({selectedResultIndex:s}),updateSingleResult:(s,t)=>e(e=>({results:e.results.map((e,a)=>a===s?t:e)})),setColumnOrder:s=>e({columnOrder:s}),addGenerationLog:s=>e(e=>({generationLogs:[...e.generationLogs,s]})),addMultipleGenerationLogs:s=>e(e=>({generationLogs:[...e.generationLogs,...s]})),clearGenerationLogs:()=>e({generationLogs:[]})}),{name:"prompt-studio-storage",storage:(0,n.KU)(()=>localStorage)})),i=["Configuration","Contexte","Playground","R\xe9sultats"];function o(){let e=l(e=>e.currentStep);return(0,a.jsx)("div",{className:"w-full max-w-2xl mx-auto my-8",children:(0,a.jsx)("div",{className:"flex items-center justify-between",children:i.map((s,t)=>{let r=t+1,n=r===e,l=r<e;return(0,a.jsxs)("div",{className:"flex items-center flex-1",children:[(0,a.jsxs)("div",{className:"flex flex-col items-center",children:[(0,a.jsx)("div",{className:"w-8 h-8 rounded-full flex items-center justify-center text-sm font-bold\n                    ".concat(l?"bg-green-500 text-white":"","\n                    ").concat(n?"bg-slate-900 text-white":"","\n                    ").concat(l||n?"":"bg-slate-200 text-slate-500","\n                  "),children:l?"✓":r}),(0,a.jsx)("p",{className:"mt-2 text-xs text-center font-semibold ".concat(n?"text-slate-900":"text-slate-500"),children:s})]}),r<i.length&&(0,a.jsx)("div",{className:"flex-auto border-t-2 mx-4 \n                  ".concat(l?"border-green-500":"border-slate-200")})]},s)})})})}var d=t(2115),c=t(2467),u=t(3101),x=t(2821),m=t(5889);function h(){for(var e=arguments.length,s=Array(e),t=0;t<e;t++)s[t]=arguments[t];return(0,m.QP)((0,x.$)(s))}let p=(0,u.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-white hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9","icon-sm":"size-8","icon-lg":"size-10"}},defaultVariants:{variant:"default",size:"default"}});function g(e){let{className:s,variant:t,size:r,asChild:n=!1,...l}=e,i=n?c.DX:"button";return(0,a.jsx)(i,{"data-slot":"button",className:h(p({variant:t,size:r,className:s})),...l})}function f(e){let{className:s,...t}=e;return(0,a.jsx)("div",{"data-slot":"card",className:h("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",s),...t})}function j(e){let{className:s,...t}=e;return(0,a.jsx)("div",{"data-slot":"card-header",className:h("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-2 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",s),...t})}function v(e){let{className:s,...t}=e;return(0,a.jsx)("div",{"data-slot":"card-title",className:h("leading-none font-semibold",s),...t})}function b(e){let{className:s,...t}=e;return(0,a.jsx)("div",{"data-slot":"card-content",className:h("px-6",s),...t})}function N(e){let{className:s,type:t,...r}=e;return(0,a.jsx)("input",{type:t,"data-slot":"input",className:h("file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input h-9 w-full min-w-0 rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",s),...r})}var y=t(5824),w=t(4033),C=t(5917),z=t(2108);function A(e){let{...s}=e;return(0,a.jsx)(y.bL,{"data-slot":"select",...s})}function R(e){let{...s}=e;return(0,a.jsx)(y.WT,{"data-slot":"select-value",...s})}function S(e){let{className:s,size:t="default",children:r,...n}=e;return(0,a.jsxs)(y.l9,{"data-slot":"select-trigger","data-size":t,className:h("border-input data-[placeholder]:text-muted-foreground [&_svg:not([class*='text-'])]:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 dark:hover:bg-input/50 flex w-fit items-center justify-between gap-2 rounded-md border bg-transparent px-3 py-2 text-sm whitespace-nowrap shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 data-[size=default]:h-9 data-[size=sm]:h-8 *:data-[slot=select-value]:line-clamp-1 *:data-[slot=select-value]:flex *:data-[slot=select-value]:items-center *:data-[slot=select-value]:gap-2 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",s),...n,children:[r,(0,a.jsx)(y.In,{asChild:!0,children:(0,a.jsx)(w.A,{className:"size-4 opacity-50"})})]})}function k(e){let{className:s,children:t,position:r="popper",align:n="center",...l}=e;return(0,a.jsx)(y.ZL,{children:(0,a.jsxs)(y.UC,{"data-slot":"select-content",className:h("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 relative z-50 max-h-(--radix-select-content-available-height) min-w-[8rem] origin-(--radix-select-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border shadow-md","popper"===r&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",s),position:r,align:n,...l,children:[(0,a.jsx)(F,{}),(0,a.jsx)(y.LM,{className:h("p-1","popper"===r&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)] scroll-my-1"),children:t}),(0,a.jsx)(V,{})]})})}function L(e){let{className:s,children:t,...r}=e;return(0,a.jsxs)(y.q7,{"data-slot":"select-item",className:h("focus:bg-accent focus:text-accent-foreground [&_svg:not([class*='text-'])]:text-muted-foreground relative flex w-full cursor-default items-center gap-2 rounded-sm py-1.5 pr-8 pl-2 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4 *:[span]:last:flex *:[span]:last:items-center *:[span]:last:gap-2",s),...r,children:[(0,a.jsx)("span",{className:"absolute right-2 flex size-3.5 items-center justify-center",children:(0,a.jsx)(y.VF,{children:(0,a.jsx)(C.A,{className:"size-4"})})}),(0,a.jsx)(y.p4,{children:t})]})}function F(e){let{className:s,...t}=e;return(0,a.jsx)(y.PP,{"data-slot":"select-scroll-up-button",className:h("flex cursor-default items-center justify-center py-1",s),...t,children:(0,a.jsx)(z.A,{className:"size-4"})})}function V(e){let{className:s,...t}=e;return(0,a.jsx)(y.wn,{"data-slot":"select-scroll-down-button",className:h("flex cursor-default items-center justify-center py-1",s),...t,children:(0,a.jsx)(w.A,{className:"size-4"})})}var M=t(9511),E=t(5229);function D(e){let{...s}=e;return(0,a.jsx)(M.bL,{"data-slot":"dialog",...s})}function I(e){let{...s}=e;return(0,a.jsx)(M.l9,{"data-slot":"dialog-trigger",...s})}function P(e){let{...s}=e;return(0,a.jsx)(M.ZL,{"data-slot":"dialog-portal",...s})}function _(e){let{...s}=e;return(0,a.jsx)(M.bm,{"data-slot":"dialog-close",...s})}function T(e){let{className:s,...t}=e;return(0,a.jsx)(M.hJ,{"data-slot":"dialog-overlay",className:h("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",s),...t})}function q(e){let{className:s,children:t,showCloseButton:r=!0,...n}=e;return(0,a.jsxs)(P,{"data-slot":"dialog-portal",children:[(0,a.jsx)(T,{}),(0,a.jsxs)(M.UC,{"data-slot":"dialog-content",className:h("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",s),...n,children:[t,r&&(0,a.jsxs)(M.bm,{"data-slot":"dialog-close",className:"ring-offset-background focus:ring-ring data-[state=open]:bg-accent data-[state=open]:text-muted-foreground absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",children:[(0,a.jsx)(E.A,{}),(0,a.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})}function O(e){let{className:s,...t}=e;return(0,a.jsx)("div",{"data-slot":"dialog-header",className:h("flex flex-col gap-2 text-center sm:text-left",s),...t})}function K(e){let{className:s,...t}=e;return(0,a.jsx)("div",{"data-slot":"dialog-footer",className:h("flex flex-col-reverse gap-2 sm:flex-row sm:justify-end",s),...t})}function G(e){let{className:s,...t}=e;return(0,a.jsx)(M.hE,{"data-slot":"dialog-title",className:h("text-lg leading-none font-semibold",s),...t})}var U=t(6046),H=t(8734),Q=t(1360),B=t(5299),W=t(2529),J=t(8874),Z=t(652),X=t(6826),$=t(8720),Y=t(926);let ee=(0,Y.createServerReference)("4077505fad787e7e08d33f9ed94e9c9d3f635581eb",Y.callServer,void 0,Y.findSourceMapURL,"testLLMConnection"),es=(0,Y.createServerReference)("40872e551770e022325896aa5afeaa55e7ef5b1a6a",Y.callServer,void 0,Y.findSourceMapURL,"debugAzureConnection"),et=["OpenAI","Azure OpenAI","Anthropic","Google","Mistral"],ea=["gemini-1.5-flash","gemini-pro","gemini-2.5-flash"],er=["border-l-sky-500","border-l-violet-500","border-l-emerald-500","border-l-amber-500","border-l-rose-500"];function en(){let{llmConfigs:e,addLlmConfig:s,updateLlmConfig:t,removeLlmConfig:r,loadLlmConfigs:n}=l(),[i,o]=(0,d.useState)({}),[c,u]=(0,d.useState)({isLoading:!1,logs:[]}),x=(0,d.useRef)(null),m=async(s,a)=>{o(e=>({...e,[s]:"testing"}));let r={...e[a]};"Azure OpenAI"===r.provider&&"entraId"===r.azureAuthMode&&(r.apiKey="");let n=await ee(r);n.success?(t(a,{isValidated:!0}),o(e=>({...e,[s]:"success"})),$.oR.success("Succ\xe8s",{description:n.message})):(t(a,{isValidated:!1}),o(e=>({...e,[s]:"error"})),$.oR.error("\xc9chec",{description:n.message}))},h=async s=>{u({isLoading:!0,logs:[]});let t=e[s];u({isLoading:!1,logs:(await es(t)).logs})};return(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold",children:"\xc9tape 1 : Connectez vos mod\xe8les (LLM)"}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsxs)(g,{variant:"outline",size:"sm",onClick:()=>{let s="data:application/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(e,null,2)),t=document.createElement("a");t.setAttribute("href",s),t.setAttribute("download","rfp-studio-config.json"),t.click(),$.oR.success("Configuration sauvegard\xe9e !")},children:[(0,a.jsx)(U.A,{className:"h-4 w-4 mr-2"}),"Sauvegarder"]}),(0,a.jsxs)(g,{variant:"outline",size:"sm",onClick:()=>{var e;return null==(e=x.current)?void 0:e.click()},children:[(0,a.jsx)(H.A,{className:"h-4 w-4 mr-2"}),"Charger"]}),(0,a.jsx)("input",{type:"file",ref:x,className:"hidden",accept:".json",onChange:e=>{var s;let t=null==(s=e.target.files)?void 0:s[0];if(!t)return;let a=new FileReader;a.onload=e=>{try{var s;let t=null==(s=e.target)?void 0:s.result,a=JSON.parse(t);n(a),$.oR.success("Configuration charg\xe9e avec succ\xe8s !")}catch(e){$.oR.error("Le fichier de configuration est invalide.")}},a.readAsText(t),x.current&&(x.current.value="")}})]})]}),e.map((e,s)=>(0,a.jsxs)(f,{className:"border-l-4 ".concat(er[s%er.length]),children:[(0,a.jsxs)(j,{className:"flex flex-row items-center justify-between",children:[(0,a.jsxs)(v,{className:"text-lg",children:["Configuration LLM #",s+1]}),(0,a.jsx)(g,{variant:"ghost",size:"icon",onClick:()=>r(s),children:(0,a.jsx)(Q.A,{className:"h-4 w-4"})})]}),(0,a.jsxs)(b,{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("label",{className:"text-sm font-medium",children:"Fournisseur"}),(0,a.jsxs)(A,{value:e.provider,onValueChange:e=>t(s,{provider:e,isValidated:!1}),children:[(0,a.jsx)(S,{children:(0,a.jsx)(R,{placeholder:"Choisir..."})}),(0,a.jsx)(k,{children:et.map(e=>(0,a.jsx)(L,{value:e,children:e},e))})]})]}),"Azure OpenAI"===e.provider&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("label",{className:"text-sm font-medium",children:"M\xe9thode d'authentification"}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(g,{variant:"entraId"!==e.azureAuthMode?"default":"outline",size:"sm",onClick:()=>t(s,{azureAuthMode:"apiKey",apiKey:e.apiKey}),children:"API Key"}),(0,a.jsx)(g,{variant:"entraId"===e.azureAuthMode?"default":"outline",size:"sm",onClick:()=>t(s,{azureAuthMode:"entraId"}),children:"Azure Entra ID"})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("label",{className:"text-sm font-medium",children:"Endpoint URL"}),(0,a.jsx)(N,{placeholder:"https://...",value:e.endpoint,onChange:e=>t(s,{endpoint:e.target.value})})]}),"entraId"!==e.azureAuthMode&&(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("label",{className:"text-sm font-medium",children:"Cl\xe9 API"}),(0,a.jsx)(N,{type:"password",value:e.apiKey,onChange:e=>t(s,{apiKey:e.target.value})})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("label",{className:"text-sm font-medium",children:"API Version"}),(0,a.jsx)(N,{placeholder:"2025-01-01-preview",value:e.apiVersion,onChange:e=>t(s,{apiVersion:e.target.value})})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("label",{className:"text-sm font-medium",children:"Deployment Name"}),(0,a.jsx)(N,{placeholder:"gpt-5-miniRGH",value:e.deployment,onChange:e=>t(s,{deployment:e.target.value})})]})]})]}),"Google"===e.provider&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("label",{className:"text-sm font-medium",children:"Cl\xe9 API"}),(0,a.jsx)(N,{type:"password",value:e.apiKey,onChange:e=>t(s,{apiKey:e.target.value})})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("label",{className:"text-sm font-medium",children:"Mod\xe8le"}),(0,a.jsxs)(A,{value:e.model,onValueChange:e=>t(s,{model:e}),children:[(0,a.jsx)(S,{children:(0,a.jsx)(R,{})}),(0,a.jsx)(k,{children:ea.map(e=>(0,a.jsx)(L,{value:e,children:e},e))})]})]})]}),e.provider&&!["Azure OpenAI","Google"].includes(e.provider)&&(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("label",{className:"text-sm font-medium",children:"Cl\xe9 API"}),(0,a.jsx)(N,{type:"password",placeholder:"sk-...",value:e.apiKey,onChange:e=>t(s,{apiKey:e.target.value})})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsxs)(g,{onClick:()=>m(e.id,s),disabled:!e.provider||"testing"===i[e.id],children:["testing"===i[e.id]&&(0,a.jsx)(B.A,{className:"mr-2 h-4 w-4 animate-spin"}),"success"===i[e.id]&&(0,a.jsx)(W.A,{className:"mr-2 h-4 w-4 text-green-500"}),"error"===i[e.id]&&(0,a.jsx)(J.A,{className:"mr-2 h-4 w-4 text-red-500"}),"Tester la connexion"]}),"Azure OpenAI"===e.provider&&(0,a.jsxs)(D,{children:[(0,a.jsx)(I,{asChild:!0,children:(0,a.jsxs)(g,{variant:"outline",onClick:()=>h(s),children:[(0,a.jsx)(Z.A,{className:"h-4 w-4 mr-2"}),"Advanced Debug"]})}),(0,a.jsxs)(q,{className:"sm:max-w-[625px]",children:[(0,a.jsx)(O,{children:(0,a.jsx)(G,{children:"Journal de D\xe9bogage Azure OpenAI"})}),(0,a.jsxs)("div",{className:"h-96 overflow-y-auto bg-slate-900 text-white font-mono text-xs p-4 rounded-md",children:[c.isLoading&&(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)(B.A,{className:"mr-2 h-4 w-4 animate-spin"}),(0,a.jsx)("span",{children:"Test en cours..."})]}),c.logs.map((e,s)=>(0,a.jsx)("p",{className:"".concat(e.includes("❌")||e.includes("ERREUR")?"text-red-400":""," ").concat(e.includes("✅")?"text-green-400":""),children:e},s))]}),(0,a.jsx)(K,{children:(0,a.jsx)(g,{onClick:()=>u({isLoading:!1,logs:[]}),children:"Fermer"})})]})]})]})]})]},e.id)),(0,a.jsxs)(g,{variant:"outline",onClick:s,children:[(0,a.jsx)(X.A,{className:"mr-2 h-4 w-4"})," Ajouter un mod\xe8le"]})]})}var el=t(1654),ei=t(9715),eo=t(4246);function ed(){let{projectData:e,setProjectData:s,setMapping:t}=l(),[r,n]=(0,d.useState)(!1),[i,o]=(0,d.useState)(null);return(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold",children:"\xc9tape 2 : D\xe9finition du Contexte"}),(0,a.jsx)("p",{className:"text-slate-600",children:"Chargez un fichier Excel (.xlsx) et d\xe9finissez les colonnes de travail."}),(0,a.jsxs)(f,{children:[(0,a.jsx)(j,{children:(0,a.jsx)(v,{children:"Chargement du Fichier"})}),(0,a.jsx)(b,{children:e?(0,a.jsxs)("div",{className:"flex items-center justify-between p-4 bg-slate-100 rounded-md",children:[(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)(ei.A,{className:"w-6 h-6 text-slate-700"}),(0,a.jsx)("p",{className:"ml-4 font-medium",children:e.fileName})]}),(0,a.jsx)(g,{variant:"link",size:"sm",onClick:()=>s(null),children:"Changer"})]}):(0,a.jsxs)("label",{className:"flex flex-col items-center justify-center w-full h-32 border-2 border-dashed rounded-lg cursor-pointer hover:bg-slate-50",children:[r?(0,a.jsx)(B.A,{className:"w-8 h-8 text-slate-500 animate-spin"}):(0,a.jsx)(el.A,{className:"w-8 h-8 text-slate-500"}),(0,a.jsx)("p",{className:"mt-2 text-sm text-slate-600",children:r?"Analyse du fichier...":"Cliquez ou glissez-d\xe9posez un fichier .xlsx"}),(0,a.jsx)("input",{type:"file",className:"hidden",accept:".xlsx",onChange:e=>{var t;let a=null==(t=e.target.files)?void 0:t[0];if(!a)return;n(!0);let r=new FileReader;r.onload=e=>{try{var t;let r=null==(t=e.target)?void 0:t.result,n=eo.LF(r,{type:"binary"}),l=n.SheetNames.map(e=>{let s=n.Sheets[e],t=eo.Wp.sheet_to_json(s,{header:1}),a=t.length>0?t[0].map(String):[],r=eo.Wp.sheet_to_json(s);return{name:e,columns:a,rows:r,questionColumn:null,answerColumn:null}});if(0===l.length||l.every(e=>0===e.columns.length))return void $.oR.error("Le fichier semble vide ou ne contient pas d'en-t\xeates.");let i={fileName:a.name,workbookBinary:r,sheets:l};s(i),o(l[0].name)}catch(e){console.error("Erreur lors de la lecture du fichier Excel :",e),$.oR.error("Le format du fichier est invalide.",{description:"Veuillez v\xe9rifier qu'il s'agit d'un fichier .xlsx valide."})}finally{n(!1)}},r.readAsBinaryString(a)},disabled:r})]})})]}),e&&(0,a.jsxs)(f,{children:[(0,a.jsx)(j,{children:(0,a.jsx)(v,{children:"Mapping des Colonnes"})}),(0,a.jsxs)(b,{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("label",{className:"text-sm font-medium",children:"Onglet"}),(0,a.jsxs)(A,{value:null!=i?i:void 0,onValueChange:o,children:[(0,a.jsx)(S,{children:(0,a.jsx)(R,{placeholder:"Choisir un onglet"})}),(0,a.jsx)(k,{children:e.sheets.map(e=>(0,a.jsx)(L,{value:e.name,children:e.name},e.name))})]})]}),i&&(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:(()=>{let s=e.sheets.find(e=>e.name===i);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm font-medium",children:"Colonne des Questions"}),(0,a.jsxs)(A,{onValueChange:e=>t(s.name,"question",e),value:s.questionColumn||void 0,children:[(0,a.jsx)(S,{children:(0,a.jsx)(R,{placeholder:"Choisir une colonne..."})}),(0,a.jsx)(k,{children:s.columns.map(e=>(0,a.jsx)(L,{value:e,children:e},e))})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm font-medium",children:"Colonne des R\xe9ponses (R\xe9f\xe9rence)"}),(0,a.jsxs)(A,{onValueChange:e=>t(s.name,"answer",e),value:s.answerColumn||void 0,children:[(0,a.jsx)(S,{children:(0,a.jsx)(R,{placeholder:"Choisir une colonne..."})}),(0,a.jsx)(k,{children:s.columns.map(e=>(0,a.jsx)(L,{value:e,children:e},e))})]})]})]})})()}),(0,a.jsxs)("div",{className:"bg-slate-50 border rounded-md p-3 text-sm space-y-2",children:[(0,a.jsx)("p",{className:"font-medium text-slate-700",children:"Statut des onglets"}),(0,a.jsx)("ul",{className:"space-y-1 list-disc ml-5",children:e.sheets.map(e=>{var s,t;return(0,a.jsxs)("li",{children:[(0,a.jsx)("span",{className:"font-semibold",children:e.name})," — Q: ",null!=(s=e.questionColumn)?s:"Non d\xe9fini"," / R: ",null!=(t=e.answerColumn)?t:"Non d\xe9fini"]},e.name)})})]})]})]})]})}var ec=t(489);function eu(e){let{className:s,...t}=e;return(0,a.jsx)(ec.b,{"data-slot":"label",className:h("flex items-center gap-2 text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50",s),...t})}function ex(e){let{className:s,...t}=e;return(0,a.jsx)("textarea",{"data-slot":"textarea",className:h("border-input placeholder:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 flex field-sizing-content min-h-16 w-full rounded-md border bg-transparent px-3 py-2 text-base shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",s),...t})}var em=t(9484);function eh(e){let{className:s,value:t,...r}=e;return(0,a.jsx)(em.bL,{"data-slot":"progress",className:h("bg-primary/20 relative h-2 w-full overflow-hidden rounded-full",s),...r,children:(0,a.jsx)(em.C1,{"data-slot":"progress-indicator",className:"bg-primary h-full w-full flex-1 transition-all",style:{transform:"translateX(-".concat(100-(t||0),"%)")}})})}var ep=t(773),eg=t(9051);function ef(e){let{className:s,...t}=e;return(0,a.jsx)(ep.bL,{"data-slot":"radio-group",className:h("grid gap-3",s),...t})}function ej(e){let{className:s,...t}=e;return(0,a.jsx)(ep.q7,{"data-slot":"radio-group-item",className:h("border-input text-primary focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 aspect-square size-4 shrink-0 rounded-full border shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",s),...t,children:(0,a.jsx)(ep.C1,{"data-slot":"radio-group-indicator",className:"relative flex items-center justify-center",children:(0,a.jsx)(eg.A,{className:"fill-primary absolute top-1/2 left-1/2 size-2 -translate-x-1/2 -translate-y-1/2"})})})}let ev=(0,Y.createServerReference)("700cf13863712079344a0b4e555b504e56b9b8a4aa",Y.callServer,void 0,Y.findSourceMapURL,"generateSingleLLMResponse"),eb=["Expert Dynamics 365 Sales","Expert Dynamics 365 Customer Insights","Expert Dynamics 365 Customer Service","Expert Dynamics 365 Contact Center","Expert Power Platform","Architecte d'Int\xe9gration","Expert S\xe9curit\xe9 Azure","Expert Conformit\xe9 et RGPD"];function eN(){let{projectData:e,llmConfigs:s,setResults:t,generationParams:r,setGenerationParams:n,setCurrentStep:i,generationProgress:o,setGenerationProgress:c,generationLogs:u,addMultipleGenerationLogs:x,clearGenerationLogs:m}=l(),[h,p]=(0,d.useState)(!1),[N,y]=(0,d.useState)(!1),w=(0,d.useRef)(null);(0,d.useEffect)(()=>{w.current&&(w.current.scrollTop=w.current.scrollHeight)},[u]);let C=async a=>{if(!e)return void $.oR.error("Veuillez charger un fichier \xe0 l'\xe9tape 2.");let n=e.sheets.filter(e=>e.questionColumn);if(0===n.length)return void $.oR.error("Aucun onglet n'est mapp\xe9.");p(!0),t([]),m(),a&&y(!0);let l=n.flatMap(e=>e.rows.map((s,t)=>({sheetName:e.name,rowIndex:t,question:s[e.questionColumn]})).filter(e=>!!e.question)),o=l.length;c({current:0,total:o});let d=[];for(let e=0;e<o;e++){let{question:t,sheetName:a,rowIndex:n}=l[e];x(["--- D\xe9but Question ".concat(e+1,"/").concat(o,': "').concat(t.substring(0,40),'..." ---')]);try{var u;let{result:e,logs:l}=await ev(t,s,r),i=null==(u=s.find(e=>e.isValidated))?void 0:u.provider,o=i&&e[i]?i:"";d.push({...e,sheetName:a,rowIndex:n,selectedAnswer:o}),x(l)}catch(l){$.oR.error("Erreur sur la question ".concat(e+1),{description:l.message});let r={question:t,sheetName:a,rowIndex:n,status:"Refus\xe9e",...s.reduce((e,s)=>({...e,[s.provider]:"ERREUR FATALE: ".concat(l.message)}),{})};d.push(r),x(["❌ ERREUR FATALE: ".concat(l.message)])}x(["--- Fin Question ".concat(e+1,"/").concat(o," ---\n")]),c({current:e+1,total:o})}t(d),p(!1),$.oR.success("G\xe9n\xe9ration termin\xe9e !"),a?(x(["✅ TRAITEMENT TERMIN\xc9 !"]),setTimeout(()=>{y(!1),i(4)},3e3)):i(4)};return(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold",children:"\xc9tape 3 : Playground de G\xe9n\xe9ration"}),(0,a.jsx)("p",{className:"text-slate-600",children:"D\xe9finissez les param\xe8tres et lancez la g\xe9n\xe9ration des r\xe9ponses."}),(0,a.jsxs)(f,{children:[(0,a.jsxs)(j,{children:[(0,a.jsx)(v,{children:"Param\xe8tres de G\xe9n\xe9ration"}),(0,a.jsxs)("p",{className:"text-sm text-muted-foreground pt-1",children:[(0,a.jsx)("span",{className:"font-bold",children:e?e.sheets.reduce((e,s)=>e+s.rows.length,0):0})," lignes charg\xe9es (toutes feuilles)."]})]}),(0,a.jsxs)(b,{className:"space-y-6",children:[h?(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(eu,{children:"Progression"}),(0,a.jsx)(eh,{value:o.current/o.total*100}),(0,a.jsxs)("p",{className:"text-sm text-center text-slate-600",children:[o.current," / ",o.total," questions trait\xe9es"]})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsx)(eu,{children:"Langue de la r\xe9ponse"}),(0,a.jsxs)(ef,{value:r.language,onValueChange:e=>n({language:e}),className:"flex space-x-4",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(ej,{value:"Fran\xe7ais",id:"lang-fr"}),(0,a.jsx)(eu,{htmlFor:"lang-fr",children:"Fran\xe7ais"})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(ej,{value:"Anglais",id:"lang-en"}),(0,a.jsx)(eu,{htmlFor:"lang-en",children:"Anglais"})]})]})]}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsx)(eu,{children:"Taille de la r\xe9ponse"}),(0,a.jsxs)(ef,{value:r.responseLength,onValueChange:e=>n({responseLength:e}),className:"flex space-x-4",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(ej,{value:"Courte",id:"len-s"}),(0,a.jsx)(eu,{htmlFor:"len-s",children:"Courte"})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(ej,{value:"Moyenne",id:"len-m"}),(0,a.jsx)(eu,{htmlFor:"len-m",children:"Moyenne"})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(ej,{value:"Longue",id:"len-l"}),(0,a.jsx)(eu,{htmlFor:"len-l",children:"Longue"})]})]})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(eu,{children:"Persona"}),(0,a.jsxs)(A,{value:r.persona,onValueChange:e=>n({persona:e}),children:[(0,a.jsx)(S,{children:(0,a.jsx)(R,{})}),(0,a.jsx)(k,{children:eb.map(e=>(0,a.jsx)(L,{value:e,children:e},e))})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(eu,{children:"Instructions Suppl\xe9mentaires"}),(0,a.jsx)(ex,{placeholder:"Ex: Adopter un ton professionnel...",value:r.instructions,onChange:e=>n({instructions:e.target.value})})]})]}),(0,a.jsxs)("div",{className:"flex flex-col space-y-2 pt-4",children:[(0,a.jsxs)(g,{onClick:()=>C(!1),disabled:h,className:"w-full",children:[h?(0,a.jsx)(B.A,{className:"mr-2 h-4 w-4 animate-spin"}):"\uD83D\uDE80",h?"G\xe9n\xe9ration en cours...":"Lancer la G\xe9n\xe9ration"]}),(0,a.jsxs)(g,{variant:"outline",onClick:()=>C(!0),disabled:h,className:"w-full",children:[(0,a.jsx)(ei.A,{className:"mr-2 h-4 w-4"}),"G\xe9n\xe9rer avec Log"]})]})]})]}),(0,a.jsx)(D,{open:N,onOpenChange:y,children:(0,a.jsxs)(q,{className:"max-w-4xl h-[80vh] flex flex-col",children:[(0,a.jsx)(O,{children:(0,a.jsx)(G,{children:"Log de G\xe9n\xe9ration en Temps R\xe9el"})}),(0,a.jsx)("div",{ref:w,className:"flex-1 h-full overflow-y-auto bg-slate-900 text-white font-mono text-xs p-4 rounded-md",children:u.map((e,s)=>(0,a.jsx)("p",{className:"".concat(e.includes("ERREUR")?"text-red-400":""," ").concat(e.includes("✅")?"text-green-400":""),children:e},s))})]})})]})}function ey(e){let{className:s,...t}=e;return(0,a.jsx)("div",{"data-slot":"table-container",className:"relative w-full overflow-x-auto",children:(0,a.jsx)("table",{"data-slot":"table",className:h("w-full caption-bottom text-sm",s),...t})})}function ew(e){let{className:s,...t}=e;return(0,a.jsx)("thead",{"data-slot":"table-header",className:h("[&_tr]:border-b",s),...t})}function eC(e){let{className:s,...t}=e;return(0,a.jsx)("tbody",{"data-slot":"table-body",className:h("[&_tr:last-child]:border-0",s),...t})}function ez(e){let{className:s,...t}=e;return(0,a.jsx)("tr",{"data-slot":"table-row",className:h("hover:bg-muted/50 data-[state=selected]:bg-muted border-b transition-colors",s),...t})}function eA(e){let{className:s,...t}=e;return(0,a.jsx)("th",{"data-slot":"table-head",className:h("text-foreground h-10 px-2 text-left align-middle font-medium whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",s),...t})}function eR(e){let{className:s,...t}=e;return(0,a.jsx)("td",{"data-slot":"table-cell",className:h("p-2 align-middle whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",s),...t})}let eS=(0,u.F)("inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90",secondary:"border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90",destructive:"border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground"}},defaultVariants:{variant:"default"}});function ek(e){let{className:s,variant:t,asChild:r=!1,...n}=e,l=r?c.DX:"span";return(0,a.jsx)(l,{"data-slot":"badge",className:h(eS({variant:t}),s),...n})}function eL(e){let{...s}=e;return(0,a.jsx)(M.bL,{"data-slot":"sheet",...s})}function eF(e){let{...s}=e;return(0,a.jsx)(M.ZL,{"data-slot":"sheet-portal",...s})}function eV(e){let{className:s,...t}=e;return(0,a.jsx)(M.hJ,{"data-slot":"sheet-overlay",className:h("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",s),...t})}function eM(e){let{className:s,children:t,side:r="right",...n}=e;return(0,a.jsxs)(eF,{children:[(0,a.jsx)(eV,{}),(0,a.jsxs)(M.UC,{"data-slot":"sheet-content",className:h("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out fixed z-50 flex flex-col gap-4 shadow-lg transition ease-in-out data-[state=closed]:duration-300 data-[state=open]:duration-500","right"===r&&"data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right inset-y-0 right-0 h-full w-3/4 border-l sm:max-w-sm","left"===r&&"data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left inset-y-0 left-0 h-full w-3/4 border-r sm:max-w-sm","top"===r&&"data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top inset-x-0 top-0 h-auto border-b","bottom"===r&&"data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom inset-x-0 bottom-0 h-auto border-t",s),...n,children:[t,(0,a.jsxs)(M.bm,{className:"ring-offset-background focus:ring-ring data-[state=open]:bg-secondary absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none",children:[(0,a.jsx)(E.A,{className:"size-4"}),(0,a.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})}function eE(e){let{className:s,...t}=e;return(0,a.jsx)("div",{"data-slot":"sheet-header",className:h("flex flex-col gap-1.5 p-4",s),...t})}function eD(e){let{className:s,...t}=e;return(0,a.jsx)("div",{"data-slot":"sheet-footer",className:h("mt-auto flex flex-col gap-2 p-4",s),...t})}function eI(e){let{className:s,...t}=e;return(0,a.jsx)(M.hE,{"data-slot":"sheet-title",className:h("text-foreground font-semibold",s),...t})}var eP=t(9476),e_=t(6651),eT=t(2944),eq=t(2273),eO=t(7787),eK=t(9027),eG=t(7587);let eU=["Expert Dynamics 365 Sales","Expert Dynamics 365 Customer Insights","Expert Dynamics 365 Customer Service","Expert Dynamics 365 Contact Center","Expert Power Platform","Architecte d'Int\xe9gration","Expert S\xe9curit\xe9 Azure","Expert Conformit\xe9 et RGPD"];function eH(){let{selectedResultIndex:e,results:s,llmConfigs:t,setSelectedResultIndex:r,updateSingleResult:n,generationParams:i}=l(),[o,c]=(0,d.useState)(null),[u,x]=(0,d.useState)(!1),[m,h]=(0,d.useState)(i);(0,d.useEffect)(()=>{null!==e&&s[e]?(c({...s[e]}),h(i)):c(null)},[e,s,i]);let p=(e,s)=>{o&&c({...o,[e]:s})},N=async()=>{if(o){x(!0),$.oR.info("R\xe9g\xe9n\xe9ration en cours...");try{var e;let{result:s}=await ev(o.question,t,m),a={...o};for(let e in s)"question"!==e&&(a[e]=s[e]);let r=null==(e=t.find(e=>e.isValidated))?void 0:e.provider;!a.selectedAnswer&&r&&s[r]&&(a.selectedAnswer=r),c(a),$.oR.success("R\xe9ponse r\xe9g\xe9n\xe9r\xe9e avec succ\xe8s !")}catch(e){$.oR.error("La r\xe9g\xe9n\xe9ration a \xe9chou\xe9.",{description:e.message})}finally{x(!1)}}};return o?(0,a.jsx)(eL,{open:null!==e,onOpenChange:s=>!u&&r(s?e:null),children:(0,a.jsxs)(eM,{className:"w-full md:w-[60vw] sm:max-w-none flex flex-col",children:[(0,a.jsx)(eE,{children:(0,a.jsx)(eI,{children:"D\xe9tail et Modification"})}),u&&(0,a.jsxs)("div",{className:"absolute inset-0 bg-white/80 flex items-center justify-center z-10",children:[(0,a.jsx)(B.A,{className:"h-8 w-8 animate-spin"}),(0,a.jsx)("p",{className:"ml-2",children:"R\xe9g\xe9n\xe9ration en cours..."})]}),(0,a.jsxs)("div",{className:"space-y-4 py-4 flex-1 overflow-y-auto",children:[(0,a.jsxs)(f,{children:[(0,a.jsx)(j,{children:(0,a.jsx)(v,{children:"Question"})}),(0,a.jsx)(b,{children:(0,a.jsx)("p",{className:"text-sm font-medium",children:o.question})})]}),t.filter(e=>e.isValidated).map(e=>(0,a.jsxs)(f,{children:[(0,a.jsx)(j,{children:(0,a.jsxs)(v,{children:["R\xe9ponse de ",e.provider]})}),(0,a.jsx)(b,{children:(0,a.jsx)(ex,{value:o[e.provider]||"",onChange:s=>p(e.provider,s.target.value),className:"h-48 whitespace-pre-wrap font-mono text-xs"})})]},e.id)),t.some(e=>e.isValidated)&&(0,a.jsxs)(f,{children:[(0,a.jsx)(j,{children:(0,a.jsx)(v,{children:"R\xe9ponse choisie pour l'export"})}),(0,a.jsx)(b,{children:(0,a.jsxs)(A,{value:o.selectedAnswer||"",onValueChange:e=>p("selectedAnswer",e),children:[(0,a.jsx)(S,{children:(0,a.jsx)(R,{placeholder:"Choisir un provider"})}),(0,a.jsxs)(k,{children:[(0,a.jsx)(L,{value:"",children:"(premi\xe8re r\xe9ponse non vide)"}),t.filter(e=>e.isValidated).map(e=>(0,a.jsx)(L,{value:e.provider,children:e.provider},e.id))]})]})})]}),(0,a.jsxs)(f,{children:[(0,a.jsx)(j,{children:(0,a.jsx)(v,{children:"Validation"})}),(0,a.jsx)(b,{children:(0,a.jsxs)(ef,{value:o.status,onValueChange:e=>p("status",e),children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(ej,{value:"Valid\xe9e",id:"s-validee"}),(0,a.jsx)(eu,{htmlFor:"s-validee",children:"Valid\xe9e"})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(ej,{value:"Doute",id:"s-doute"}),(0,a.jsx)(eu,{htmlFor:"s-doute",children:"Doute"})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(ej,{value:"Refus\xe9e",id:"s-refusee"}),(0,a.jsx)(eu,{htmlFor:"s-refusee",children:"Refus\xe9e"})]})]})})]})]}),(0,a.jsxs)(eD,{children:[(0,a.jsxs)(D,{children:[(0,a.jsx)(I,{asChild:!0,children:(0,a.jsx)(g,{variant:"outline",children:"R\xe9g\xe9n\xe9rer"})}),(0,a.jsxs)(q,{children:[(0,a.jsx)(O,{children:(0,a.jsx)(G,{children:"Param\xe8tres de R\xe9g\xe9n\xe9ration"})}),(0,a.jsxs)("div",{className:"space-y-4 py-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(eu,{children:"Langue"}),(0,a.jsxs)(ef,{value:m.language,onValueChange:e=>h({...m,language:e}),children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(ej,{value:"Fran\xe7ais",id:"r-lang-fr"}),(0,a.jsx)(eu,{htmlFor:"r-lang-fr",children:"Fran\xe7ais"})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(ej,{value:"Anglais",id:"r-lang-en"}),(0,a.jsx)(eu,{htmlFor:"r-lang-en",children:"Anglais"})]})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(eu,{children:"Taille"}),(0,a.jsxs)(ef,{value:m.responseLength,onValueChange:e=>h({...m,responseLength:e}),children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(ej,{value:"Courte",id:"r-len-s"}),(0,a.jsx)(eu,{htmlFor:"r-len-s",children:"Courte"})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(ej,{value:"Moyenne",id:"r-len-m"}),(0,a.jsx)(eu,{htmlFor:"r-len-m",children:"Moyenne"})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(ej,{value:"Longue",id:"r-len-l"}),(0,a.jsx)(eu,{htmlFor:"r-len-l",children:"Longue"})]})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(eu,{children:"Persona"}),(0,a.jsxs)(A,{value:m.persona,onValueChange:e=>h({...m,persona:e}),children:[(0,a.jsx)(S,{children:(0,a.jsx)(R,{})}),(0,a.jsx)(k,{children:eU.map(e=>(0,a.jsx)(L,{value:e,children:e},e))})]})]})]}),(0,a.jsxs)(K,{children:[(0,a.jsx)(_,{asChild:!0,children:(0,a.jsx)(g,{variant:"ghost",children:"Annuler"})}),(0,a.jsx)(_,{asChild:!0,children:(0,a.jsx)(g,{onClick:N,children:"Lancer la R\xe9g\xe9n\xe9ration"})})]})]})]}),(0,a.jsx)(g,{onClick:()=>{null!==e&&o&&(n(e,o),$.oR.success("Modifications enregistr\xe9es !"),r(null))},children:"Enregistrer et Fermer"})]})]})}):null}let eQ=e=>{var s;let{header:t}=e,{attributes:r,listeners:n,setNodeRef:l,transform:i,transition:o}=(0,eK.gl)({id:t.column.id}),d={transform:eG.Ks.Transform.toString(i),transition:o,width:t.getSize()};return(0,a.jsxs)(eA,{colSpan:t.colSpan,style:d,ref:l,className:"relative group bg-slate-50",children:[(0,a.jsxs)("div",{...r,...n,className:"flex items-center justify-center cursor-grab py-4 px-2",children:[(0,a.jsx)(eP.A,{className:"h-4 w-4 mr-2 text-muted-foreground"}),(0,a.jsxs)("div",{className:"flex-grow font-bold text-slate-700",onClick:t.column.getToggleSortingHandler(),children:[(0,eT.Kv)(t.column.columnDef.header,t.getContext()),null!=(s=({asc:" ▲",desc:" ▼"})[t.column.getIsSorted()])?s:null]})]}),(0,a.jsx)("div",{onMouseDown:t.getResizeHandler(),onTouchStart:t.getResizeHandler(),className:"absolute top-0 right-0 h-full w-1 bg-primary/20 opacity-0 group-hover:opacity-100 cursor-col-resize user-select-none"})]},t.id)};function eB(){var e,s;let{results:t,llmConfigs:r,setSelectedResultIndex:n,setResults:i,generationParams:o,columnOrder:c,setColumnOrder:u,projectData:x}=l(),[m,h]=(0,d.useState)([]),[p,f]=(0,d.useState)([]),[j,v]=(0,d.useState)(""),[b,y]=(0,d.useState)(!1),[w,C]=(0,d.useState)(o),[z,F]=(0,d.useState)({current:0,total:0}),[V,M]=(0,d.useState)(!1),E=r.filter(e=>e.isValidated),P=E.map(e=>e.provider),_=(0,d.useMemo)(()=>[{id:"rowNumber",header:"N\xb0",cell:e=>(0,a.jsx)("div",{className:"text-center text-muted-foreground",children:e.row.index+1}),size:60,enableResizing:!1},{accessorKey:"sheetName",header:"Onglet",cell:e=>(0,a.jsx)("div",{className:"text-sm text-muted-foreground px-2",children:e.getValue()}),size:140,minSize:100,maxSize:200},{accessorKey:"question",header:"Question",cell:e=>(0,a.jsx)("div",{className:"font-medium text-sm p-2",children:e.getValue()}),size:450,minSize:200,maxSize:800},...E.map(e=>({accessorKey:e.provider,header:e.provider,cell:e=>(0,a.jsx)("div",{className:"text-xs whitespace-pre-wrap font-mono p-2",children:e.getValue()||"N/A"}),size:400,minSize:150,maxSize:700})),{accessorKey:"selectedAnswer",header:"R\xe9ponse choisie",cell:e=>{let s=e.row.original;return(0,a.jsxs)(A,{value:s.selectedAnswer||"",onValueChange:a=>{let r=[...t];r[e.row.index]={...s,selectedAnswer:a},i(r)},children:[(0,a.jsx)(S,{className:"w-[180px]",children:(0,a.jsx)(R,{placeholder:"Choisir"})}),(0,a.jsxs)(k,{children:[(0,a.jsx)(L,{value:"",children:"(premi\xe8re r\xe9ponse non vide)"}),P.map(e=>(0,a.jsx)(L,{value:e,children:e},e))]})]})},size:220,minSize:180,maxSize:260},{accessorKey:"status",header:"Statut",cell:e=>{let s=e.getValue();return(0,a.jsx)("div",{className:"p-2 flex justify-center",children:(0,a.jsx)(ek,{variant:"Valid\xe9e"===s?"default":"Refus\xe9e"===s?"destructive":"secondary",children:s})})},size:150,enableResizing:!1}],[E]),T=(0,d.useMemo)(()=>_.map(e=>e.id||e.accessorKey),[_]);(0,d.useEffect)(()=>{(0===c.length||c.length!==T.length)&&u(T)},[T,c,u]);let U=(0,eT.N4)({data:t,columns:_,state:{sorting:m,columnFilters:p,globalFilter:j,columnOrder:c},onSortingChange:h,onColumnFiltersChange:f,onGlobalFilterChange:v,columnResizeMode:"onChange",getCoreRowModel:(0,eq.HT)(),getSortedRowModel:(0,eq.h5)(),getFilteredRowModel:(0,eq.hM)()}),H=(0,eO.FR)((0,eO.MS)(eO.cA),(0,eO.MS)(eO.IG),(0,eO.MS)(eO.uN)),Q=async()=>{let e=t.map((e,s)=>({...e,originalIndex:s})).filter(e=>"Doute"===e.status||"Refus\xe9e"===e.status);if(0===e.length){$.oR.info("Aucune r\xe9ponse \xe0 r\xe9g\xe9n\xe9rer."),M(!1);return}y(!0),F({current:0,total:e.length});let s=[...t];for(let t=0;t<e.length;t++){let a=e[t];try{let e=await ev(a.question,r,w),t=P[0],n=t&&e[t]?t:a.selectedAnswer||"";s[a.originalIndex]={...e,sheetName:a.sheetName,rowIndex:a.rowIndex,selectedAnswer:n}}catch(e){$.oR.error('Erreur sur la question: "'.concat(a.question.substring(0,20),'..."'))}F({current:t+1,total:e.length})}i(s),y(!1),$.oR.success("R\xe9g\xe9n\xe9ration en masse termin\xe9e !"),setTimeout(()=>{M(!1)},2e3)};return 0===t.length?(0,a.jsxs)("div",{className:"text-center py-12",children:[(0,a.jsx)("h2",{className:"text-xl font-bold",children:"\xc9tape 4 : R\xe9sultats"}),(0,a.jsx)("p",{className:"text-slate-600 mt-4",children:"Aucun r\xe9sultat. Lancez une g\xe9n\xe9ration \xe0 l'\xe9tape 3."})]}):(0,a.jsxs)("div",{className:"space-y-4 w-full",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold",children:"\xc9tape 4 : R\xe9sultats"}),(0,a.jsx)("p",{className:"text-slate-600",children:"Filtrez, triez, r\xe9organisez, redimensionnez et exportez vos r\xe9sultats."}),(0,a.jsxs)("div",{className:"flex flex-col md:flex-row gap-4 justify-between items-center bg-slate-50 p-4 rounded-lg border",children:[(0,a.jsxs)("div",{className:"relative w-full md:w-1/3",children:[(0,a.jsx)(e_.A,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),(0,a.jsx)(N,{placeholder:"Rechercher sur toutes les colonnes...",value:j,onChange:e=>v(e.target.value),className:"pl-10"})]}),(0,a.jsxs)("div",{className:"flex gap-4 items-center w-full md:w-auto",children:[(0,a.jsxs)(A,{value:null!=(s=null==(e=U.getColumn("status"))?void 0:e.getFilterValue())?s:"",onValueChange:e=>{var s;return null==(s=U.getColumn("status"))?void 0:s.setFilterValue("Tous"===e?"":e)},children:[(0,a.jsx)(S,{className:"w-full md:w-[180px]",children:(0,a.jsx)(R,{placeholder:"Filtrer par statut..."})}),(0,a.jsxs)(k,{children:[(0,a.jsx)(L,{value:"Tous",children:"Tous les statuts"}),(0,a.jsx)(L,{value:"Valid\xe9e",children:"Valid\xe9e"}),(0,a.jsx)(L,{value:"Doute",children:"Doute"}),(0,a.jsx)(L,{value:"Refus\xe9e",children:"Refus\xe9e"})]})]}),(0,a.jsxs)(D,{open:V,onOpenChange:M,children:[(0,a.jsx)(I,{asChild:!0,children:(0,a.jsx)(g,{variant:"outline",children:"R\xe9g\xe9n\xe9rer les \xe9checs"})}),(0,a.jsxs)(q,{onInteractOutside:e=>{b&&e.preventDefault()},children:[(0,a.jsx)(O,{children:(0,a.jsx)(G,{children:"R\xe9g\xe9n\xe9ration en Masse"})}),b?(0,a.jsxs)("div",{className:"py-4 space-y-4",children:[(0,a.jsx)("p",{children:"La r\xe9g\xe9n\xe9ration est en cours. Veuillez patienter."}),(0,a.jsx)(eh,{value:z.current/z.total*100}),(0,a.jsxs)("p",{className:"text-sm text-center text-muted-foreground",children:[z.current," / ",z.total," r\xe9ponses trait\xe9es"]})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"space-y-4 py-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(eu,{children:"Langue"}),(0,a.jsxs)(ef,{value:w.language,onValueChange:e=>C({...w,language:e}),children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(ej,{value:"Fran\xe7ais",id:"br-lang-fr"}),(0,a.jsx)(eu,{htmlFor:"br-lang-fr",children:"Fran\xe7ais"})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(ej,{value:"Anglais",id:"br-lang-en"}),(0,a.jsx)(eu,{htmlFor:"br-lang-en",children:"Anglais"})]})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(eu,{children:"Taille"}),(0,a.jsxs)(ef,{value:w.responseLength,onValueChange:e=>C({...w,responseLength:e}),children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(ej,{value:"Courte",id:"br-len-s"}),(0,a.jsx)(eu,{htmlFor:"br-len-s",children:"Courte"})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(ej,{value:"Moyenne",id:"br-len-m"}),(0,a.jsx)(eu,{htmlFor:"br-len-m",children:"Moyenne"})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(ej,{value:"Longue",id:"br-len-l"}),(0,a.jsx)(eu,{htmlFor:"br-len-l",children:"Longue"})]})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(eu,{children:"Persona"}),(0,a.jsxs)(A,{value:w.persona,onValueChange:e=>C({...w,persona:e}),children:[(0,a.jsx)(S,{children:(0,a.jsx)(R,{})}),(0,a.jsx)(k,{children:eU.map(e=>(0,a.jsx)(L,{value:e,children:e},e))})]})]})]}),(0,a.jsxs)(K,{children:[(0,a.jsx)(g,{variant:"ghost",onClick:()=>M(!1),children:"Annuler"}),(0,a.jsx)(g,{onClick:Q,children:"Lancer la R\xe9g\xe9n\xe9ration"})]})]})]})]}),(0,a.jsx)(g,{onClick:()=>{if(!x)return void $.oR.error("Aucun fichier source charg\xe9.");let e=eo.LF(x.workbookBinary,{type:"binary"}),s=new Map(x.sheets.map(e=>[e.name,e])),a=r.filter(e=>e.isValidated).map(e=>e.provider),n=(e,s)=>{let t=eo.Wp.decode_range(e["!ref"]||"A1");t.s.r=Math.min(t.s.r,s.r),t.s.c=Math.min(t.s.c,s.c),t.e.r=Math.max(t.e.r,s.r),t.e.c=Math.max(t.e.c,s.c),e["!ref"]=eo.Wp.encode_range(t)},l=e=>{if(e.selectedAnswer){let s=e[e.selectedAnswer];if("string"==typeof s)return s}for(let s of a){let t=e[s];if("string"==typeof t&&t.trim().length>0)return t}return""},i=0;for(let a of t){let t=s.get(a.sheetName),r=e.Sheets[a.sheetName];if(!t||!r){console.warn("Feuille introuvable: ".concat(a.sheetName));continue}if(!t.answerColumn)return void $.oR.error("Colonne r\xe9ponse non d\xe9finie pour l'onglet ".concat(a.sheetName,"."));let o=t.columns.indexOf(t.answerColumn);if(-1===o)return void $.oR.error('Impossible de trouver la colonne r\xe9ponse "'.concat(t.answerColumn,"\" dans l'onglet ").concat(a.sheetName,"."));let d={c:o,r:a.rowIndex+1};r[eo.Wp.encode_cell(d)]={t:"s",v:l(a)},n(r,d),i++}let o=eo.M9(e,{bookType:"xlsx",type:"binary"}),d=new ArrayBuffer(o.length),c=new Uint8Array(d);for(let e=0;e<o.length;++e)c[e]=255&o.charCodeAt(e);let u=new Blob([d],{type:"application/octet-stream"}),m=URL.createObjectURL(u),h=document.createElement("a");h.href=m,h.download="rfp-".concat(x.fileName),h.click(),URL.revokeObjectURL(m),$.oR.success("Fichier export\xe9 (".concat(i," lignes mises \xe0 jour)."))},disabled:b,children:"Exporter"})]})]}),(0,a.jsx)("div",{className:"border rounded-md overflow-x-auto",children:(0,a.jsx)(eO.Mp,{sensors:H,collisionDetection:eO.fp,onDragEnd:e=>{let{active:s,over:t}=e;if(s.id!==(null==t?void 0:t.id)){let e=c.indexOf(s.id),a=c.indexOf(t.id);u((0,eK.be)(c,e,a))}},children:(0,a.jsxs)(ey,{style:{width:U.getTotalSize()},children:[(0,a.jsx)(ew,{children:U.getHeaderGroups().map(e=>(0,a.jsx)(ez,{children:(0,a.jsx)(eK.gB,{items:c,strategy:eK.m$,children:e.headers.map(e=>(0,a.jsx)(eQ,{header:e},e.id))})},e.id))}),(0,a.jsx)(eC,{children:U.getRowModel().rows.map(e=>(0,a.jsx)(ez,{onClick:()=>n(e.index),className:"cursor-pointer ".concat((e=>{switch(e){case"Valid\xe9e":return"bg-green-50 hover:bg-green-100";case"Doute":return"bg-yellow-50 hover:bg-yellow-100";case"Refus\xe9e":return"bg-red-50 hover:bg-red-100";default:return"hover:bg-slate-50"}})(e.original.status)),children:e.getVisibleCells().map(e=>(0,a.jsx)(eR,{style:{width:e.column.getSize()},className:"align-top border-r",children:(0,eT.Kv)(e.column.columnDef.cell,e.getContext())},e.id))},e.id))})]})})}),(0,a.jsx)(eH,{})]})}function eW(){let{currentStep:e,setCurrentStep:s,llmConfigs:t,projectData:r,results:n}=l(),[i,c]=(0,d.useState)(!1);(0,d.useEffect)(()=>{l.persist.rehydrate(),c(!0)},[]);let u=t.some(e=>e.isValidated),x=!!(null==r?void 0:r.questionColumn)&&!!(null==r?void 0:r.answerColumn),m=n.length>0;return i?(0,a.jsxs)("div",{className:"".concat(4===e?"container-fluid px-4 md:px-8":"container"," mx-auto p-4 md:p-8 min-h-screen"),children:[(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("h1",{className:"text-5xl font-extrabold tracking-tight bg-gradient-to-r from-blue-600 via-purple-500 to-indigo-400 text-transparent bg-clip-text",children:"RFP Studio"}),(0,a.jsx)("p",{className:"text-lg text-muted-foreground mt-2",children:"G\xe9n\xe9rez et validez des r\xe9ponses avanc\xe9es \xe0 grande \xe9chelle."})]}),(0,a.jsx)(o,{}),(0,a.jsx)("div",{className:"mt-12 ".concat(4!==e?"max-w-4xl mx-auto":""),children:(()=>{switch(e){case 1:default:return(0,a.jsx)(en,{});case 2:return(0,a.jsx)(ed,{});case 3:return(0,a.jsx)(eN,{});case 4:return(0,a.jsx)(eB,{})}})()}),(0,a.jsxs)("div",{className:"mt-8 max-w-4xl mx-auto flex justify-between",children:[(0,a.jsx)(g,{variant:"outline",onClick:()=>{e>1&&s(e-1)},disabled:1===e,children:"← Pr\xe9c\xe9dent"}),e<4&&(0,a.jsx)(g,{onClick:()=>{e<4&&s(e+1)},disabled:!(1===e?u:2===e?x:3===e&&m),children:"Suivant →"})]})]}):(0,a.jsx)("div",{className:"w-screen h-screen flex items-center justify-center",children:(0,a.jsx)(B.A,{className:"h-8 w-8 animate-spin text-primary"})})}},3686:()=>{},4336:(e,s,t)=>{Promise.resolve().then(t.bind(t,2770))}},e=>{e.O(0,[524,362,805,441,255,358],()=>e(e.s=4336)),_N_E=e.O()}]);